(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{618:function(t,s,a){"use strict";a.r(s);var n=a(15),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("從輸入 URL 到頁面展示，這中間發生了什麼？這是很多前端必須理解的問題，從 URL 解析、HTTP 請求、瀏覽器解析和渲染、載乳入完成，而對於這些步驟，我們透過 CRP 優化策略，盡可能縮小網頁呈現的時間。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.imgur.com/NTS863R.png",alt:""}})]),t._v(" "),a("p",[t._v("從這張圖中，建構渲染數的前幾個步驟，也就是 DOM 和 CSSOM，這兩者是最直接影響網頁初次呈現的時間。")]),t._v(" "),a("h2",{attrs:{id:"dom-漸進式渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dom-漸進式渲染"}},[t._v("#")]),t._v(" DOM 漸進式渲染")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/progressive-rendering.png?hl=zh-cn",alt:""}})]),t._v(" "),a("p",[t._v("盡可能把畫面傳給使用者是一件很重要的事，等待加載時間越長，使用者離開網站的機率就會提升。為了留住使用者，網頁在完全載入前，會先將網站的骨架，例如 Header、Section..等部分內容預先呈現給使用者，並且盡可能的延遲更多資源，當使用到時再載入。")]),t._v(" "),a("p",[t._v("目前很多框架都有針對漸進式渲染做優化，例如 React 的 Suspense。")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" lazy "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'React'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Comments "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lazy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./Comments.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Suspense fallback"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Spinner "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Comments "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Suspense"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("從常見的 Google 搜尋頁面也可以看出來：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.imgur.com/KUtfQgX.gif",alt:""}})]),t._v(" "),a("p",[t._v("同時，Google 也針對現在流行框架的優化手段做分享：")]),t._v(" "),a("p"),a("div",{staticClass:"embed-responsive embed-responsive-16by9"},[a("iframe",{staticClass:"embed-responsive-item youtube-player",attrs:{type:"text/html",width:"640",height:"390",src:"https://www.youtube.com/embed/k-A2VfuUROg",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}})]),a("p"),t._v(" "),a("h2",{attrs:{id:"unblocking-css"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unblocking-css"}},[t._v("#")]),t._v(" Unblocking CSS")]),t._v(" "),a("p",[t._v("首先，我們要先搞清楚瀏覽器什麼時候才會開始渲染畫面？")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.imgur.com/wxSRY2H.png",alt:""}})]),t._v(" "),a("p",[t._v("A. 瀏覽器建構 DOM 之後？\nB. 瀏覽器下載了 CSS 並建構了 CSS object model 之後？")]),t._v(" "),a("p",[t._v("答案很明顯就是 B，為什麼呢？我們建構渲染樹，同時需要 DOM 和 COSSOM，因此瀏覽器需要等到獲取 CSS 後，才會繪製網頁，而 CSS 疊層樣式的特性，後面屬性的權重會大於前面的屬性，所以瀏覽器一定要等到 HTML 裡面的 CSS 都載入並解析完畢後才能顯示並執行 Javascript。")]),t._v(" "),a("p",[t._v("透過下面的方式來優化 CSS Blocking：")]),t._v(" "),a("h3",{attrs:{id:"_1-css-命名規範"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-css-命名規範"}},[t._v("#")]),t._v(" 1. CSS 命名規範")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.imgur.com/w5EBrkQ.png",alt:""}})]),t._v(" "),a("p",[t._v("CSS 的資源龐大或解析時間過長，都會拖到第一次渲染的速度，進而拖累到畫面呈現的時間以及 Javascript 的執行。CSS 的選擇器越多層，也會拖累到 CSSOM 的建構，BEM、OOCSS 等命名規範就是為了減少解析的時間，加上最大程度的減少重複，好維護之外，其實也能提升畫面渲染的效率。")]),t._v(" "),a("h3",{attrs:{id:"_2-inline-css"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-inline-css"}},[t._v("#")]),t._v(" 2. inline CSS")]),t._v(" "),a("p",[t._v("這個方法比較直觀，就是減少 Request 的數量。")]),t._v(" "),a("h3",{attrs:{id:"_3-media-query"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-media-query"}},[t._v("#")]),t._v(" 3. Media query")]),t._v(" "),a("p",[t._v("可以透過媒體查詢屬性讓瀏覽器可以忽略當下的 css 樣式。一般來說，都是這樣載入外部的 CSS:")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("stylesheet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("style.css"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("link")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("跟 inlin CSS 一樣，會等到所有的 CSS 都載入並且建構完 CSSOM 後，才會執行 Javascript 或是產生畫面。\n不過當我們這樣寫：")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("stylesheet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("style.css"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("media")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("print"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("link")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- or --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("stylesheet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("style.css"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("media")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("screen and (min-width: 600px) and (max-width: 800px)"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("link")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- or --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("stylesheet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("style.css"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("media")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("orientation: landscape"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("link")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("多了媒體查詢屬性"),a("code",[t._v("media")]),t._v("時，瀏覽器就不會因太多樣式而 block，而是依據裝置特性來優先載入解析。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.imgur.com/7sbzbpA.png",alt:""}})]),t._v(" "),a("p",[t._v("透過 chrome 開發者工具也可以看到，他會把與現在裝置不匹配的 media，放到最後載入解析。所以開發者可以思考，把響應式放到另一個 css 檔案引入，讓首次載入的效能增加。")]),t._v(" "),a("h2",{attrs:{id:"javascirpt"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#javascirpt"}},[t._v("#")]),t._v(" Javascirpt")]),t._v(" "),a("p",[t._v("Javacript 是一個非常特殊的資源，他可以新增、更新、刪除 DOM 元素，讓畫面重排、重新繪製。瀏覽器在解析 HTML 的時候，遇到 script 標籤，就會先載入，並且在 CSSOM 完成後執行(此時 HTML 會停止解析，等待 javascript 執行完畢)，接者再繪製畫面。跟 CSS 檔案一樣，太大的話，載入時間越久，網頁初次呈現的等待時間越長。")]),t._v(" "),a("h3",{attrs:{id:"兩種解析-script-的方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#兩種解析-script-的方式"}},[t._v("#")]),t._v(" 兩種解析 script 的方式")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  Awsome Page\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("write.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  is awesome.\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  Awsome Page\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n    document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("' with javascript'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  ")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  is awesome.\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("執行結果都會相同，但是第一種是需要載入外部資源的，所以他多了一個關鍵資源需要讀取：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.imgur.com/uEBXUZ2.png",alt:""}})]),t._v(" "),a("p",[t._v("如果讀取資源被阻止了，那就會無法繼續建構 DOM，進而降低 CRP 的速度。當遇到 script 標籤的時候，會阻止瀏覽器的解析器的執行，需要等待獲取文件，效能就會變差。")]),t._v(" "),a("h3",{attrs:{id:"實際上瀏覽器執行-javascript-的順序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#實際上瀏覽器執行-javascript-的順序"}},[t._v("#")]),t._v(" 實際上瀏覽器執行 Javascript 的順序")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.imgur.com/KgcGCEW.png",alt:""}})]),t._v(" "),a("p",[t._v("HTML 檔案請求載入後，會開始建構 DOM tree，但執行到 script 標籤的時候，瀏覽器解析器會停止，這時候就稱為 block。block 後會開始產生 CSSOM，因為不知道 script 的內容會不會更新到 css 樣式，CSSOM 建構完畢後，才會執行 script，然後繼續建構 DOM。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.imgur.com/IAP2LJb.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_1-壓縮、inline-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-壓縮、inline-js"}},[t._v("#")]),t._v(" 1. 壓縮、inline JS")]),t._v(" "),a("p",[t._v("這方法同樣的很直觀，壓縮減少檔案的體積，讓載入時間縮短，inline JS 則可以減少 request 數量。")]),t._v(" "),a("h3",{attrs:{id:"_2-js-盡量寫在-body-標籤底部"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-js-盡量寫在-body-標籤底部"}},[t._v("#")]),t._v(" 2. JS 盡量寫在 "),a("code",[t._v("<body>")]),t._v(" 標籤底部")]),t._v(" "),a("p",[t._v("前端開發者，一開始學習的時候，前輩都會建議把 script 不論是載入還是嵌入，都要把他寫在 "),a("code",[t._v("<body>")]),t._v(" 最下面。有想過為什麼嗎？因為 DOM 在解析的時候，他為 DOM 可以分段顯示，一行行的建構 DOM tree，但是他遇到 script 標籤會停下來，會先把目前的 DOM tree 和 CSSOM 結合產生 render tree 再來執行 script 裡面得內容。因此若是裡面有要更新會是刪除尚未建構的 DOM 時，就會出現錯誤。")]),t._v(" "),a("h3",{attrs:{id:"_3-async、defer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-async、defer"}},[t._v("#")]),t._v(" 3. async、defer")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("analytics.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("async")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("analytics.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("defer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h4",{attrs:{id:"async"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#async"}},[t._v("#")]),t._v(" async")]),t._v(" "),a("p",[t._v("會非同步去請求外部腳本 回應後停止解析執行腳本內容")]),t._v(" "),a("h4",{attrs:{id:"defer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#defer"}},[t._v("#")]),t._v(" defer")]),t._v(" "),a("p",[t._v("會非同步請求外部腳本 但是等待瀏覽器"),a("strong",[t._v("解析完")]),t._v("才執行 ("),a("strong",[t._v("而且早於 DOMContentLoaded")]),t._v(" "),a("a",{attrs:{href:"https://developer.mozilla.org/zh-TW/docs/Web/HTML/Element/script",target:"_blank",rel:"noopener noreferrer"}},[t._v("參考 MDN"),a("OutboundLink")],1),t._v(")")]),t._v(" "),a("blockquote",[a("p",[t._v("這兩個屬性，瀏覽器解析到該 script 的時候， 不會停止解析，並且不會等待 CSSOM 產生就會先執行。")])]),t._v(" "),a("h2",{attrs:{id:"結論"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#結論"}},[t._v("#")]),t._v(" 結論")]),t._v(" "),a("p",[t._v("基本上，增加 CRP 效率的基本原則，基本上可以分成三類：")]),t._v(" "),a("h5",{attrs:{id:"_1-html、css、javascript-都可以透過縮小、壓縮、緩存等方式進行最佳化。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-html、css、javascript-都可以透過縮小、壓縮、緩存等方式進行最佳化。"}},[t._v("#")]),t._v(" 1. HTML、CSS、Javascript 都可以透過縮小、壓縮、緩存等方式進行最佳化。")]),t._v(" "),a("h5",{attrs:{id:"_2-css-的-render-blocking-透過-media-來取消阻止呈現以及-inline-css。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-css-的-render-blocking-透過-media-來取消阻止呈現以及-inline-css。"}},[t._v("#")]),t._v(" 2. CSS 的 Render Blocking 透過 media 來取消阻止呈現以及 inline CSS。")]),t._v(" "),a("h5",{attrs:{id:"_3-js-的-parser-blocking-透過-asyc-defer。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-js-的-parser-blocking-透過-asyc-defer。"}},[t._v("#")]),t._v(" 3. JS 的 Parser Blocking 透過 asyc/defer。")]),t._v(" "),a("h5",{attrs:{id:"參考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#參考"}},[t._v("#")]),t._v(" 參考")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/Progressive_web_apps/Loading",target:"_blank",rel:"noopener noreferrer"}},[t._v("渐进式加载"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://classroom.udacity.com/me",target:"_blank",rel:"noopener noreferrer"}},[t._v("网站性能优化 - Udacity"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);